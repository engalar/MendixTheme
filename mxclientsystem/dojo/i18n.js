define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./has!host-browser?./_base/xhr","./json","module"],(function(e,n,o,r,i,t,a,l,c){o.add("dojo-preload-i18n-Api",1),o.add("dojo-v1x-i18n-Api",1);var u=e.i18n={},f=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,s={},d=function(n,o,r){return r=r?r.toLowerCase():e.locale,n=n.replace(/\./g,"/"),o=o.replace(/\./g,"/"),/root/i.test(r)?n+"/nls/"+o:n+"/nls/"+r+"/"+o},p=e.getL10nName=function(e,n,o){return c.id+"!"+d(e,n,o)},h=function(n,a,c){var u=f.exec(n),d=u[1]+"/",p=u[5]||u[4],h=d+p,_=u[5]&&u[4],v=_||e.locale||"",g=h+"/"+v,y=_?[v]:function(e){var n=i.extraLocale||[];return(n=t.isArray(n)?n:[n]).push(e),n}(v),b=y.length,j=function(){--b||c(t.delegate(s[g]))},A=n.split("*"),z="preload"==A[1];if(o("dojo-preload-i18n-Api")){if(z&&(s[n]||(s[n]=1,m(A[2],l.parse(A[3]),1,a)),c(1)),z||x(n,a,c)&&!s[g])return}else if(z)return void c(1);r.forEach(y,(function(e){var n=h+"/"+e;o("dojo-preload-i18n-Api")&&L(n),s[n]?j():function(e,n,o,r,i,a){e([n],(function(l){var c=t.clone(l.root||l.ROOT),u=function(e,n,o,r){for(var i=[o+r],t=n.split("-"),a="",l=0;l<t.length;l++)a+=(a?"-":"")+t[l],e&&!e[a]||(i.push(o+a+"/"+r),i.specificity=a);return i}(!l._v1x&&l,i,o,r);e(u,(function(){for(var e=1;e<u.length;e++)c=t.mixin(t.clone(c),arguments[e]);s[n+"/"+i]=c,c.$locale=u.specificity,a()}))}))}(a,h,d,p,e,j)}))};if(o("dojo-preload-i18n-Api")||o("dojo-v1x-i18n-Api"))var _=u.normalizeLocale=function(n){var o=n?n.toLowerCase():e.locale;return"root"==o?"ROOT":o},v=function(e,r){return!o("dojo-sync-loader")||!o("dojo-v1x-i18n-Api")||r.isXdUrl(n.toUrl(e+".js"))},g=0,y=[],m=u._preloadLocalizations=function(o,i,a,l){function c(e,n){for(var o=e.split("-");o.length;){if(n(o.join("-")))return;o.pop()}n("ROOT")}function u(){g++}function f(){for(--g;!g&&y.length;)h.apply(null,y.shift())}function d(e,n,o,r){return r.toAbsMid(e+n+"/"+o)}function p(e){c(e=_(e),(function(p){if(r.indexOf(i,p)>=0){var h=o.replace(/\./g,"/")+"_"+p;return u(),function(e,n){v(e,l)||a?l([e],n):z([e],n,l)}(h,(function(o){for(var r in o){var i,a,h=o[r],_=r.match(/(.+)\/([^\/]+)$/);if(_&&(i=_[2],a=_[1]+"/",h._localized)){var v;if("ROOT"===p){var g=v=h._localized;delete h._localized,g.root=h,s[n.toAbsMid(r)]=g}else v=h._localized,s[d(a,i,p,n)]=h;p!==e&&function(o,r,i,a){var p=[],h=[];c(e,(function(e){a[e]&&(p.push(n.toAbsMid(o+e+"/"+r)),h.push(d(o,r,e,n)))})),p.length?(u(),l(p,(function(){for(var a=p.length-1;a>=0;a--)i=t.mixin(t.clone(i),arguments[a]),s[h[a]]=i;s[d(o,r,e,n)]=t.clone(i),f()}))):s[d(o,r,e,n)]=i}(a,i,h,v)}}f()})),!0}return!1}))}l=l||n,p(),r.forEach(e.config.extraLocale,p)},x=function(e,n,o){return g&&y.push([e,n,o]),g},L=function(){};if(o("dojo-v1x-i18n-Api")){var b,j={},A={},z=function(e,n,o){var i=[];r.forEach(e,(function(e){var n=o.toUrl(e+".js");function r(o){b||(b=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"));var r=b(o,L,e,j);r===j?i.push(s[n]=j.result):(r instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+n,r),r={}),i.push(s[n]=/nls\/[^\/]+\/[^\/]+$/.test(n)?r:{root:r,_v1x:1}))}if(s[n])i.push(s[n]);else{var t=o.syncLoadNls(e);if(t||(t=L(e.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1"))),t)i.push(t);else if(a)a.get({url:n,sync:!0,load:r,error:function(){i.push(s[n]={})}});else try{o.getText(n,!0,r)}catch(e){i.push(s[n]={})}}})),n&&n.apply(null,i)};L=function(n){for(var o,r=n.split("/"),i=e.global[r[0]],t=1;i&&t<r.length-1;i=i[r[t++]]);return i&&((o=i[r[t]])||(o=i[r[t].replace(/-/g,"_")]),o&&(s[n]=o)),o},u.getLocalization=function(e,o,r){var i,t=d(e,o,r);return A[t]?A[t]:(h(t,v(t,n)?n:function(e,o){z(e,o,n)},(function(e){A[t]=e,i=e})),i)}}else u.getLocalization=function(e,n,o){var r=e.replace(/\./g,"/")+"/nls/"+n+"/"+(o||i.locale);return this.cache[r]};return t.mixin(u,{dynamic:!0,normalize:function(e,n){return/^\./.test(e)?n(e):e},load:h,cache:s,getL10nName:p})}));