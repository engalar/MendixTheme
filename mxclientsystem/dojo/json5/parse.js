define(["../string","./util"],(function(e,r){var t,n,i,a,c,o,u,s,f,d,l,v,m,h;function p(e,r,t){var n=e[r];if(null!=n&&"object"==typeof n)for(var i in n){var a=p(n,i,t);void 0===a?delete n[i]:n[i]=a}return t.call(e,r,n)}function w(){for(d="default",l="",v=!1,m=1;;){h=g();var e=N[d]();if(e)return e}}function g(){if(t[a])return e.fromCodePoint(e.codePointAt(t,a))}function y(){var e=g();return"\n"===e?(c++,o=0):e?o+=e.length:o++,e&&(a+=e.length),e}var N={default:function(){switch(h){case"\t":case"\v":case"\f":case" ":case" ":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void y();case"/":return y(),void(d="comment");case void 0:return y(),b("eof")}if(!r.isSpaceSeparator(h))return N[n]();y()},comment:function(){switch(h){case"*":return y(),void(d="multiLineComment");case"/":return y(),void(d="singleLineComment")}throw S(y())},multiLineComment:function(){switch(h){case"*":return y(),void(d="multiLineCommentAsterisk");case void 0:throw S(y())}y()},multiLineCommentAsterisk:function(){switch(h){case"*":return void y();case"/":return y(),void(d="default");case void 0:throw S(y())}y(),d="multiLineComment"},singleLineComment:function(){switch(h){case"\n":case"\r":case"\u2028":case"\u2029":return y(),void(d="default");case void 0:return y(),b("eof")}y()},value:function(){switch(h){case"{":case"[":return b("punctuator",y());case"n":return y(),P("ull"),b("null",null);case"t":return y(),P("rue"),b("boolean",!0);case"f":return y(),P("alse"),b("boolean",!1);case"-":case"+":return"-"===y()&&(m=-1),void(d="sign");case".":return l=y(),void(d="decimalPointLeading");case"0":return l=y(),void(d="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return l=y(),void(d="decimalInteger");case"I":return y(),P("nfinity"),b("numeric",1/0);case"N":return y(),P("aN"),b("numeric",NaN);case'"':case"'":return v='"'===y(),l="",void(d="string")}throw S(y())},identifierNameStartEscape:function(){if("u"!==h)throw S(y());y();var e=x();switch(e){case"$":case"_":break;default:if(!r.isIdStartChar(e))throw V()}l+=e,d="identifierName"},identifierName:function(){switch(h){case"$":case"_":case"‌":case"‍":return void(l+=y());case"\\":return y(),void(d="identifierNameEscape")}if(!r.isIdContinueChar(h))return b("identifier",l);l+=y()},identifierNameEscape:function(){if("u"!==h)throw S(y());y();var e=x();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!r.isIdContinueChar(e))throw V()}l+=e,d="identifierName"},sign:function(){switch(h){case".":return l=y(),void(d="decimalPointLeading");case"0":return l=y(),void(d="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return l=y(),void(d="decimalInteger");case"I":return y(),P("nfinity"),b("numeric",m*(1/0));case"N":return y(),P("aN"),b("numeric",NaN)}throw S(y())},zero:function(){switch(h){case".":return l+=y(),void(d="decimalPoint");case"e":case"E":return l+=y(),void(d="decimalExponent");case"x":case"X":return l+=y(),void(d="hexadecimal")}return b("numeric",0*m)},decimalInteger:function(){switch(h){case".":return l+=y(),void(d="decimalPoint");case"e":case"E":return l+=y(),void(d="decimalExponent")}if(!r.isDigit(h))return b("numeric",m*Number(l));l+=y()},decimalPointLeading:function(){if(r.isDigit(h))return l+=y(),void(d="decimalFraction");throw S(y())},decimalPoint:function(){switch(h){case"e":case"E":return l+=y(),void(d="decimalExponent")}return r.isDigit(h)?(l+=y(),void(d="decimalFraction")):b("numeric",m*Number(l))},decimalFraction:function(){switch(h){case"e":case"E":return l+=y(),void(d="decimalExponent")}if(!r.isDigit(h))return b("numeric",m*Number(l));l+=y()},decimalExponent:function(){switch(h){case"+":case"-":return l+=y(),void(d="decimalExponentSign")}if(r.isDigit(h))return l+=y(),void(d="decimalExponentInteger");throw S(y())},decimalExponentSign:function(){if(r.isDigit(h))return l+=y(),void(d="decimalExponentInteger");throw S(y())},decimalExponentInteger:function(){if(!r.isDigit(h))return b("numeric",m*Number(l));l+=y()},hexadecimal:function(){if(r.isHexDigit(h))return l+=y(),void(d="hexadecimalInteger");throw S(y())},hexadecimalInteger:function(){if(!r.isHexDigit(h))return b("numeric",m*Number(l));l+=y()},string:function(){switch(h){case"\\":return y(),void(l+=function(){switch(g()){case"b":return y(),"\b";case"f":return y(),"\f";case"n":return y(),"\n";case"r":return y(),"\r";case"t":return y(),"\t";case"v":return y(),"\v";case"0":if(y(),r.isDigit(g()))throw S(y());return"\0";case"x":return y(),function(){var t="",n=g();if(!r.isHexDigit(n))throw S(y());if(t+=y(),n=g(),!r.isHexDigit(n))throw S(y());return t+=y(),e.fromCodePoint(parseInt(t,16))}();case"u":return y(),x();case"\n":case"\u2028":case"\u2029":return y(),"";case"\r":return y(),"\n"===g()&&y(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw S(y())}return y()}());case'"':return v?(y(),b("string",l)):void(l+=y());case"'":return v?void(l+=y()):(y(),b("string",l));case"\n":case"\r":throw S(y());case"\u2028":case"\u2029":!function(e){console.warn("JSON5: '"+D(e)+"' in strings is not valid ECMAScript; consider escaping")}(h);break;case void 0:throw S(y())}l+=y()},start:function(){switch(h){case"{":case"[":return b("punctuator",y())}d="value"},beforePropertyName:function(){switch(h){case"$":case"_":return l=y(),void(d="identifierName");case"\\":return y(),void(d="identifierNameStartEscape");case"}":return b("punctuator",y());case'"':case"'":return v='"'===y(),void(d="string")}if(r.isIdStartChar(h))return l+=y(),void(d="identifierName");throw S(y())},afterPropertyName:function(){if(":"===h)return b("punctuator",y());throw S(y())},beforePropertyValue:function(){d="value"},afterPropertyValue:function(){switch(h){case",":case"}":return b("punctuator",y())}throw S(y())},beforeArrayValue:function(){if("]"===h)return b("punctuator",y());d="value"},afterArrayValue:function(){switch(h){case",":case"]":return b("punctuator",y())}throw S(y())},end:function(){throw S(y())}};function b(e,r){return{type:e,value:r,line:c,column:o}}function P(e){for(var r=0,t=e;r<t.length;r++){var n=t[r];if(g()!==n)throw S(y());y()}}function x(){for(var t="",n=4;n-- >0;){var i=g();if(!r.isHexDigit(i))throw S(y());t+=y()}return e.fromCodePoint(parseInt(t,16))}var A={start:function(){if("eof"===u.type)throw I();E()},beforePropertyName:function(){switch(u.type){case"identifier":case"string":return s=u.value,void(n="afterPropertyName");case"punctuator":return void C();case"eof":throw I()}},afterPropertyName:function(){if("eof"===u.type)throw I();n="beforePropertyValue"},beforePropertyValue:function(){if("eof"===u.type)throw I();E()},beforeArrayValue:function(){if("eof"===u.type)throw I();"punctuator"!==u.type||"]"!==u.value?E():C()},afterPropertyValue:function(){if("eof"===u.type)throw I();switch(u.value){case",":return void(n="beforePropertyName");case"}":C()}},afterArrayValue:function(){if("eof"===u.type)throw I();switch(u.value){case",":return void(n="beforeArrayValue");case"]":C()}},end:function(){}};function E(){var e;switch(u.type){case"punctuator":switch(u.value){case"{":e={};break;case"[":e=[]}break;case"null":case"boolean":case"numeric":case"string":e=u.value}if(void 0===f)f=e;else{var r=i[i.length-1];Array.isArray(r)?r.push(e):r[s]=e}if(null!==e&&"object"==typeof e)i.push(e),n=Array.isArray(e)?"beforeArrayValue":"beforePropertyName";else{var t=i[i.length-1];n=null==t?"end":Array.isArray(t)?"afterArrayValue":"afterPropertyValue"}}function C(){i.pop();var e=i[i.length-1];n=null==e?"end":Array.isArray(e)?"afterArrayValue":"afterPropertyValue"}function S(e){return L(void 0===e?"JSON5: invalid end of input at "+c+":"+o:"JSON5: invalid character '"+D(e)+"' at "+c+":"+o)}function I(){return L("JSON5: invalid end of input at "+c+":"+o)}function V(){return L("JSON5: invalid identifier character at "+c+":"+(o-=5))}function D(e){var r={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(r[e])return r[e];if(e<" "){var t=e.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return e}function L(e){var r=new SyntaxError(e);return r.lineNumber=c,r.columnNumber=o,r}return function(e,r){t=String(e),n="start",i=[],a=0,c=1,o=0,u=void 0,s=void 0,f=void 0;do{u=w(),A[n]()}while("eof"!==u.type);return"function"==typeof r?p({"":f},"",r):f}}));