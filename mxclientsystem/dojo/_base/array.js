define(["./kernel","../has","./lang"],(function(r,t,n){var e,i={};function f(r){var n=!r;return function(f,o,s){var c,a=0,l=f&&f.length||0;if(l&&"string"==typeof f&&(f=f.split("")),"string"==typeof o){if(t("csp-restrictions"))throw new TypeError("callback must be a function");o=i[o]||e(o)}if(s){for(;a<l;++a)if(c=!o.call(s,f[a],a,f),r^c)return!c}else for(;a<l;++a)if(c=!o(f[a],a,f),r^c)return!c;return n}}function o(r){var t=1,n=0,e=0;return r||(t=n=e=-1),function(i,f,o,c){if(c&&t>0)return s.lastIndexOf(i,f,o);var a,l=i&&i.length||0,u=r?l+e:n;for(void 0===o?a=r?n:l+e:o<0?(a=l+o)<0&&(a=n):a=o>=l?l+e:o,l&&"string"==typeof i&&(i=i.split(""));a!=u;a+=t)if(i[a]==f)return a;return-1}}t("csp-restrictions")||(e=function(r){return i[r]=new Function("item","index","array",r)});var s={every:f(!1),some:f(!0),indexOf:o(!0),lastIndexOf:o(!1),forEach:function(r,n,f){var o=0,s=r&&r.length||0;if(s&&"string"==typeof r&&(r=r.split("")),"string"==typeof n){if(t("csp-restrictions"))throw new TypeError("callback must be a function");n=i[n]||e(n)}if(f)for(;o<s;++o)n.call(f,r[o],o,r);else for(;o<s;++o)n(r[o],o,r)},map:function(r,n,f,o){var s=0,c=r&&r.length||0,a=new(o||Array)(c);if(c&&"string"==typeof r&&(r=r.split("")),"string"==typeof n){if(t("csp-restrictions"))throw new TypeError("callback must be a function");n=i[n]||e(n)}if(f)for(;s<c;++s)a[s]=n.call(f,r[s],s,r);else for(;s<c;++s)a[s]=n(r[s],s,r);return a},filter:function(r,n,f){var o,s=0,c=r&&r.length||0,a=[];if(c&&"string"==typeof r&&(r=r.split("")),"string"==typeof n){if(t("csp-restrictions"))throw new TypeError("callback must be a function");n=i[n]||e(n)}if(f)for(;s<c;++s)o=r[s],n.call(f,o,s,r)&&a.push(o);else for(;s<c;++s)n(o=r[s],s,r)&&a.push(o);return a},clearCache:function(){i={}}};return t("extend-dojo")&&n.mixin(r,s),s}));