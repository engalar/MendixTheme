define(["./kernel","../has","./lang"],(function(t,e,n){var r,i=n.mixin,o=Object.prototype,s=o.toString,a=0,c="constructor";function l(t,e){throw new Error("declare"+(e?" "+e:"")+": "+t)}function p(t,e,n,r){var i,s,a,p,h,u,f,d,y,m=this._inherited=this._inherited||{};if("string"==typeof t&&(i=t,t=e,e=n,n=r),"function"==typeof t)p=t,t=e,e=n;else try{p=t.callee}catch(t){if(!(t instanceof TypeError))throw t;l("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass)}if((i=i||p.nom)||l("can't deduce a name to call inherited()",this.declaredClass),n=r=0,a=(h=this.constructor._meta).bases,y=m.p,i!=c){if(m.c!==p&&(y=0,(h=(u=a[0])._meta).hidden[i]!==p)){(s=h.chains)&&"string"==typeof s[i]&&l("calling chained method with inherited: "+i,this.declaredClass);do{if(h=u._meta,f=u.prototype,h&&(f[i]===p&&f.hasOwnProperty(i)||h.hidden[i]===p))break}while(u=a[++y]);y=u?y:-1}if(u=a[++y])if(f=u.prototype,u._meta&&f.hasOwnProperty(i))n=f[i];else{d=o[i];do{if((n=(f=u.prototype)[i])&&(u._meta?f.hasOwnProperty(i):n!==d))break}while(u=a[++y])}n=u&&n||o[i]}else{if(m.c!==p&&(y=0,(h=a[0]._meta)&&h.ctor!==p)){for((s=h.chains)&&"manual"===s.constructor||l("calling chained constructor with inherited",this.declaredClass);(u=a[++y])&&(!(h=u._meta)||h.ctor!==p););y=u?y:-1}for(;(u=a[++y])&&!(n=(h=u._meta)?h.ctor:u););n=u&&n}if(m.c=n,m.p=y,n)return!0===e?n:n.apply(this,e||t)}function h(t,e,n){return"string"==typeof t?"function"==typeof e?this.__inherited(t,e,n,!0):this.__inherited(t,e,!0):"function"==typeof t?this.__inherited(t,e,!0):this.__inherited(t,!0)}r=e("csp-restrictions")?function(){}:new Function;var u=t.config.isDebug?function(t,e,n,r){var i=this.getInherited(t,e,n);if(i)return i.apply(this,r||n||e||t)}:p;function f(t){for(var e=this.constructor._meta.bases,n=0,r=e.length;n<r;++n)if(e[n]===t)return!0;return this instanceof t}function d(t,r){for(var i in r)i!=c&&r.hasOwnProperty(i)&&(t[i]=r[i]);if(e("bug-for-in-skips-shadowed"))for(var o=n._extraNames,s=o.length;s;)(i=o[--s])!=c&&r.hasOwnProperty(i)&&(t[i]=r[i])}function y(t){return w.safeMixin(this.prototype,t),this}function m(t,e){return t instanceof Array||"function"==typeof t||(e=t,t=void 0),e=e||{},w([this].concat(t=t||[]),e)}function b(t,e,n){return function(){var r,i,o,s=0,a=1;for(n&&(s=e.length-1,a=-1);r=e[s];s+=a)(o=((i=r._meta)?i.hidden:r.prototype)[t])&&o.apply(this,arguments)}}function _(t){r.prototype=t.prototype;var e=new r;return r.prototype=null,e}function g(t){var e=t.callee,n=_(e);return e.apply(n,t),n}function w(t,r,v){"string"!=typeof t&&(v=r,r=t,t=""),v=v||{};var O,x,j,k,P,C,F,q=1,M=r;if("[object Array]"==s.call(r)?(C=function(t,e){for(var n,r,i,o,c,p,h,u,f=[],d=[{cls:0,refs:[]}],y={},m=1,b=t.length,_=0;_<b;++_){for((i=t[_])?"[object Function]"!=s.call(i)&&l("mixin #"+_+" is not a callable constructor.",e):l("mixin #"+_+" is unknown. Did you use dojo.require to pull it in?",e),o=0,n=(r=i._meta?i._meta.bases:[i]).length-1;n>=0;--n)(c=r[n].prototype).hasOwnProperty("declaredClass")||(c.declaredClass="uniqName_"+a++),h=c.declaredClass,y.hasOwnProperty(h)||(y[h]={count:0,refs:[],cls:r[n]},++m),p=y[h],o&&o!==p&&(p.refs.push(o),++o.count),o=p;++o.count,d[0].refs.push(o)}for(;d.length;){for(o=d.pop(),f.push(o.cls),--m;1==(u=o.refs).length;){if(!(o=u[0])||--o.count){o=0;break}f.push(o.cls),--m}if(o)for(_=0,b=u.length;_<b;++_)--(o=u[_]).count||d.push(o)}return m&&l("can't build consistent linearization",e),i=t[0],f[0]=i?i._meta&&i===f[f.length-i._meta.bases.length]?i._meta.bases.length:1:0,f}(r,t),j=C[0],r=C[q=C.length-j]):(C=[0],r?"[object Function]"==s.call(r)?(j=r._meta,C=C.concat(j?j.bases:r)):l("base class is not a callable constructor.",t):null!==r&&l("unknown base class. Did you use dojo.require to pull it in?",t)),r)for(x=q-1;O=_(r),x;--x)((j=C[x])._meta?d:i)(O,j.prototype),(k=e("csp-restrictions")?function(){}:new Function).superclass=r,k.prototype=O,r=O.constructor=k;else O={};for(w.safeMixin(O,v),(j=v.constructor)!==o.constructor&&(j.nom=c,O.constructor=j),x=q-1;x;--x)(j=C[x]._meta)&&j.chains&&(F=i(F||{},j.chains));if(O["-chains-"]&&(F=i(F||{},O["-chains-"])),r&&r.prototype&&r.prototype["-chains-"]&&(F=i(F||{},r.prototype["-chains-"])),j=!F||!F.hasOwnProperty(c),C[0]=k=F&&"manual"===F.constructor?function(t){return function(){var e,n,r=arguments,i=0;if(!(this instanceof r.callee))return g(r);for(;e=t[i];++i)if(e=(n=e._meta)?n.ctor:e){e.apply(this,r);break}(e=this.postscript)&&e.apply(this,r)}}(C):1==C.length?function(t,e){return function(){var n,r=arguments,i=r,o=r[0];if(!(this instanceof r.callee))return g(r);e&&(o&&(n=o.preamble)&&(i=n.apply(this,i)||i),(n=this.preamble)&&n.apply(this,i)),t&&t.apply(this,r),(n=this.postscript)&&n.apply(this,r)}}(v.constructor,j):function(t,e){return function(){var n,r,i,o,s=arguments,a=s,c=s[0],l=t.length;if(!(this instanceof s.callee))return g(s);if(e&&(c&&c.preamble||this.preamble))for((o=new Array(t.length))[0]=s,r=0;(c=s[0])&&(n=c.preamble)&&(s=n.apply(this,s)||s),(n=(n=t[r].prototype).hasOwnProperty("preamble")&&n.preamble)&&(s=n.apply(this,s)||s),++r!=l;)o[r]=s;for(r=l-1;r>=0;--r)(n=(i=(n=t[r])._meta)?i.ctor:n)&&n.apply(this,o?o[r]:s);(n=this.postscript)&&n.apply(this,a)}}(C,j),k._meta={bases:C,hidden:v,chains:F,parents:M,ctor:v.constructor},k.superclass=r&&r.prototype,k.extend=y,k.createSubclass=m,k.prototype=O,O.constructor=k,O.getInherited=h,O.isInstanceOf=f,O.inherited=u,O.__inherited=p,t&&(O.declaredClass=t,n.setObject(t,k)),F)for(P in F)O[P]&&"string"==typeof F[P]&&P!=c&&((j=O[P]=b(P,C,"after"===F[P])).nom=P);return k}return t.safeMixin=w.safeMixin=function(t,r){var i,a;for(i in r)(a=r[i])===o[i]&&i in o||i==c||("[object Function]"==s.call(a)&&(a.nom=i),t[i]=a);if(e("bug-for-in-skips-shadowed")&&r)for(var l=n._extraNames,p=l.length;p;)(a=r[i=l[--p]])===o[i]&&i in o||i==c||("[object Function]"==s.call(a)&&(a.nom=i),t[i]=a);return t},t.declare=w,w}));