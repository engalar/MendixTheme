define(["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],(function(o,t,n,e,i,a,r,s){o.hash=function(o,t){return arguments.length?("#"==o.charAt(0)&&(o=o.substring(1)),t?p(o):location.hash="#"+o,o):f()};var l,h,c,u=n.hashPollFrequency||100;function d(o,t){var n=o.indexOf(t);return n>=0?o.substring(n+1):""}function f(){return d(location.href,"#")}function m(){a.publish("/dojo/hashchange",f())}function g(){f()!==l&&(l=f(),m())}function p(o){if(h){if(h.isTransitioning())return void setTimeout(i.hitch(null,p,o),u);var t=(n=h.iframe.location.href).indexOf("?");h.iframe.location.replace(n.substring(0,t)+"?"+o)}else{var n=location.href.replace(/#.*/,"");location.replace(n+"#"+o),!c&&g()}}function b(){var e=document.createElement("iframe"),a="dojo-hash-iframe",r=n.dojoBlankHtmlUrl||t.toUrl("./resources/blank.html");n.useXDomain&&!n.dojoBlankHtmlUrl&&console.warn("dojo/hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),e.id=a,e.src=r+"?"+f(),e.style.display="none",document.body.appendChild(e),this.iframe=o.global[a];var s,h,c,g,p,b=this.iframe.location;function v(){l=f(),s=p?l:d(b.href,"?"),h=!1,c=null}this.isTransitioning=function(){return h},this.pollLocation=function(){if(!p)try{var o=d(b.href,"?");document.title!=g&&(g=this.iframe.document.title=document.title)}catch(o){p=!0,console.error("dojo/hash: Error adding history entry. Server unreachable.")}var t=f();if(h&&l===t){if(!p&&o!==c)return void setTimeout(i.hitch(this,this.pollLocation),0);v(),m()}else if(l!==t||!p&&s!==o){if(l!==t)return l=t,h=!0,c=t,e.src=r+"?"+c,p=!1,void setTimeout(i.hitch(this,this.pollLocation),0);p||(location.href="#"+b.search.substring(1),v(),m())}setTimeout(i.hitch(this,this.pollLocation),u)},v(),setTimeout(i.hitch(this,this.pollLocation),u)}return r((function(){"onhashchange"in o.global&&(!s("ie")||s("ie")>=8&&"BackCompat"!=document.compatMode)?c=e.after(o.global,"onhashchange",m,!0):document.addEventListener?(l=f(),setInterval(g,u)):document.attachEvent&&(h=new b)})),o.hash}));