define(["../_base/array","../_base/lang","../Deferred","../when"],(function(e,r,n,s){"use strict";var t=e.some;return function(e){var i,l,a;r.isArray(e)?l=e:e&&"object"==typeof e&&(i=e);var u=[];if(i){for(var o in l=[],i)Object.hasOwnProperty.call(i,o)&&(u.push(o),l.push(i[o]));a={}}else l&&(a=[]);if(!l||!l.length)return(new n).resolve(a);var f=new n;f.promise.always((function(){a=u=null}));var c=l.length;return t(l,(function(e,r){return i||u.push(r),s(e,(function(e){f.isFulfilled()||(a[u[r]]=e,0==--c&&f.resolve(a))}),f.reject),f.isFulfilled()})),f.promise}}));