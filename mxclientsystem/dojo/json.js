define(["./has"],(function(has){"use strict";var hasJSON="undefined"!=typeof JSON;if(has.add("json-parse",hasJSON),has.add("json-stringify",hasJSON&&'{"a":1}'==JSON.stringify({a:0},(function(n,r){return r||1}))),has("json-stringify"))return JSON;var escapeString=function(n){return('"'+n.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};return{parse:has("json-parse")?JSON.parse:function(str,strict){if(strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str))throw new SyntaxError("Invalid characters in JSON");return eval("("+str+")")},stringify:function(n,r,e){return"string"==typeof r&&(e=r,r=null),function n(t,i,a){r&&(t=r(a,t));var s,f=typeof t;if("number"==f)return isFinite(t)?t+"":"null";if("boolean"==f)return t+"";if(null===t)return"null";if("string"==typeof t)return escapeString(t);if("function"!=f&&"undefined"!=f){if("function"==typeof t.toJSON)return n(t.toJSON(a),i,a);if(t instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,(function(n,r,e){var i=t["getUTC"+r]()+(e?1:0);return i<10?"0"+i:i}));if(t.valueOf()!==t)return n(t.valueOf(),i,a);var u=e?i+e:"",o=e?" ":"",c=e?"\n":"";if(t instanceof Array){var l=t.length,p=[];for(a=0;a<l;a++)"string"!=typeof(s=n(t[a],u,a))&&(s="null"),p.push(c+u+s);return"["+p.join(",")+c+i+"]"}var g=[];for(a in t){var h;if(t.hasOwnProperty(a)){if("number"==typeof a)h='"'+a+'"';else{if("string"!=typeof a)continue;h=escapeString(a)}if("string"!=typeof(s=n(t[a],u,a)))continue;g.push(c+u+h+":"+o+s)}}return"{"+g.join(",")+c+i+"}"}}(n,"","")}}}));