define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],(function(e,r,n,a,t){var i={};if(e.setObject("dojo.number",i),i.format=function(n,a){a=e.mixin({},a||{});var t=r.normalizeLocale(a.locale),l=r.getLocalization("dojo.cldr","number",t);a.customs=l;var o=a.pattern||l[(a.type||"decimal")+"Format"];return isNaN(n)||Math.abs(n)==1/0?null:i._applyPattern(n,o,a)},i._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/,i._applyPattern=function(e,r,n){var a=(n=n||{}).customs.group,t=n.customs.decimal,l=r.split(";"),o=l[0];if(-1!=(r=l[e<0?1:0]||"-"+o).indexOf("%"))e*=100;else if(-1!=r.indexOf("‰"))e*=1e3;else if(-1!=r.indexOf("¤"))a=n.customs.currencyGroup||a,t=n.customs.currencyDecimal||t,r=r.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/,(function(e,r,a,t){var i=["symbol","currency","displayName"][a.length-1],l=n[i]||n.currency||"";return l?r+l+t:""}));else if(-1!=r.indexOf("E"))throw new Error("exponential notation not supported");var u=i._numberPatternRE,c=o.match(u);if(!c)throw new Error("unable to find a number expression in pattern: "+r);return!1===n.fractional&&(n.places=0),r.replace(u,i._formatAbsolute(e,c[0],{decimal:t,group:a,places:n.places,round:n.round}))},i.round=function(e,r,n){var a=10/(n||10);return(a*+e).toFixed(r)/a},0==.9.toFixed()){var l=i.round;i.round=function(e,r,n){var a=Math.pow(10,-r||0),t=Math.abs(e);return(!e||t>=a||(t/=a)<.5||t>=.95)&&(a=0),l(e,r,n)+(e>0?a:-a)}}return i._formatAbsolute=function(e,r,n){!0===(n=n||{}).places&&(n.places=0),n.places===1/0&&(n.places=6);var t=r.split("."),l="string"==typeof n.places&&n.places.indexOf(","),o=n.places;l?o=n.places.substring(l+1):o>=0||(o=(t[1]||[]).length),n.round<0||(e=i.round(e,o,n.round));var u=String(Math.abs(e)).split("."),c=u[1]||"";if(t[1]||n.places){l&&(n.places=n.places.substring(0,l));var s=void 0!==n.places?n.places:t[1]&&t[1].lastIndexOf("0")+1;s>c.length&&(u[1]=a.pad(c,s,"0",!0)),o<c.length&&(u[1]=c.substr(0,o))}else u[1]&&u.pop();var p=t[0].replace(",","");-1!=(s=p.indexOf("0"))&&((s=p.length-s)>u[0].length&&(u[0]=a.pad(u[0],s)),-1==p.indexOf("#")&&(u[0]=u[0].substr(u[0].length-s)));var f,d,g=t[0].lastIndexOf(",");if(-1!=g){f=t[0].length-g-1;var x=t[0].substr(0,g);-1!=(g=x.lastIndexOf(","))&&(d=x.length-g-1)}for(var m=[],v=u[0];v;){var b=v.length-f;m.push(b>0?v.substr(b):v),v=b>0?v.slice(0,b):"",d&&(f=d,d=void 0)}return u[0]=m.reverse().join(n.group||","),u.join(n.decimal||".")},i.regexp=function(e){return i._parseInfo(e).regexp},i._parseInfo=function(e){e=e||{};var n=r.normalizeLocale(e.locale),a=r.getLocalization("dojo.cldr","number",n),l=e.pattern||a[(e.type||"decimal")+"Format"],o=a.group,u=a.decimal,c=1;if(-1!=l.indexOf("%"))c/=100;else if(-1!=l.indexOf("‰"))c/=1e3;else{var s=-1!=l.indexOf("¤");s&&(o=a.currencyGroup||o,u=a.currencyDecimal||u)}var p=l.split(";");1==p.length&&p.push("-"+p[0]);var f=t.buildGroupRE(p,(function(r){return(r="(?:"+t.escapeString(r,".")+")").replace(i._numberPatternRE,(function(r){var n={signed:!1,separator:e.strict?o:[o,""],fractional:e.fractional,decimal:u,exponent:!1},a=r.split("."),t=e.places;1==a.length&&1!=c&&(a[1]="###"),1==a.length||0===t?n.fractional=!1:(void 0===t&&(t=e.pattern?a[1].lastIndexOf("0")+1:1/0),t&&null==e.fractional&&(n.fractional=!0),!e.places&&t<a[1].length&&(t+=","+a[1].length),n.places=t);var l=a[0].split(",");return l.length>1&&(n.groupSize=l.pop().length,l.length>1&&(n.groupSize2=l.pop().length)),"("+i._realNumberRegexp(n)+")"}))}),!0);return s&&(f=f.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/g,(function(r,n,a,i){var l=["symbol","currency","displayName"][a.length-1],o=t.escapeString(e[l]||e.currency||"");return o?(n=n?"[\\s\\xa0\\u202f]":"",i=i?"[\\s\\xa0\\u202f]":"",e.strict?n+o+i:(n&&(n+="*"),i&&(i+="*"),"(?:"+n+o+i+")?")):""}))),{regexp:f.replace(/[\xa0\u202f ]/g,"[\\s\\xa0\\u202f]"),group:o,decimal:u,factor:c}},i.parse=function(e,r){var n=i._parseInfo(r),a=new RegExp("^"+n.regexp+"$").exec(e);if(!a)return NaN;var t=a[1];if(!a[1]){if(!a[2])return NaN;t=a[2],n.factor*=-1}return(t=t.replace(new RegExp("["+n.group+"\\s\\xa0\\u202f]","g"),"").replace(n.decimal,"."))*n.factor},i._realNumberRegexp=function(e){"places"in(e=e||{})||(e.places=1/0),"string"!=typeof e.decimal&&(e.decimal="."),"fractional"in e&&!/^0/.test(e.places)||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);var r=i._integerRegexp(e),n=t.buildGroupRE(e.fractional,(function(r){var n="";return r&&0!==e.places&&(n="\\"+e.decimal,e.places==1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n}),!0),a=r+n;return n&&(a="(?:(?:"+a+")|(?:"+n+"))"),a+t.buildGroupRE(e.exponent,(function(r){return r?"([eE]"+i._integerRegexp({signed:e.eSigned})+")":""}))},i._integerRegexp=function(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",t.buildGroupRE(e.signed,(function(e){return e?"[-+]":""}),!0)+t.buildGroupRE(e.separator,(function(r){if(!r)return"(?:\\d+)";" "==(r=t.escapeString(r))?r="\\s":" "==r?r="\\s\\xa0":" "==r&&(r="\\s\\u202f");var n=e.groupSize,a=e.groupSize2;if(a){var i="(?:0|[1-9]\\d{0,"+(a-1)+"}(?:["+r+"]\\d{"+a+"})*["+r+"]\\d{"+n+"})";return n-a>0?"(?:"+i+"|(?:0|[1-9]\\d{0,"+(n-1)+"}))":i}return"(?:0|[1-9]\\d{0,"+(n-1)+"}(?:["+r+"]\\d{"+n+"})*)"}),!0)},i}));