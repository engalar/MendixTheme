define(["./_base/kernel","./aspect","./dom","./dom-class","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],(function(e,t,o,n,a,c,u,i,r,s){var d,g,l,h,m,f,v,p,b,T,y=u("ios")<5,j=u("pointer-events")||u("MSPointer"),w=function(){var e={};for(var t in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[t]=u("MSPointer")?"MSPointer"+t.charAt(0).toUpperCase()+t.slice(1):"pointer"+t;return e}(),X=u("touch-events"),D=!1;function Y(e,t,o){return j&&o?function(e,t){return c(e,o,t)}:X?function(o,n){var a=c(o,t,(function(e){n.call(this,e),b=(new Date).getTime()})),u=c(o,e,(function(e){(!b||(new Date).getTime()>b+1e3)&&n.call(this,e)}));return{remove:function(){a.remove(),u.remove()}}}:function(t,o){return c(t,e,o)}}function k(e,t,a){if(!i.isRight(e)){var u=function(e){do{if(void 0!==e.dojoClick)return e}while(e=e.parentNode)}(e.target);if((g=!e.target.disabled&&u&&u.dojoClick)&&(l=(D="useTarget"==g)?u:e.target,D&&e.preventDefault(),h=e.changedTouches?e.changedTouches[0].pageX-s.global.pageXOffset:e.clientX,m=e.changedTouches?e.changedTouches[0].pageY-s.global.pageYOffset:e.clientY,f=("object"==typeof g?g.x:"number"==typeof g?g:0)||4,v=("object"==typeof g?g.y:"number"==typeof g?g:0)||4,!d)){d=!0;var r=function(e){g=D?o.isDescendant(s.doc.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-s.global.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-s.global.pageYOffset:e.clientY),l):g&&(e.changedTouches?e.changedTouches[0].target:e.target)==l&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-s.global.pageXOffset:e.clientX)-h)<=f&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-s.global.pageYOffset:e.clientY)-m)<=v};s.doc.addEventListener(t,(function(e){i.isRight(e)||(r(e),D&&e.preventDefault())}),!0),s.doc.addEventListener(a,(function(e){if(!i.isRight(e)&&(r(e),g)){p=(new Date).getTime();var t=D?l:e.target;"LABEL"===t.tagName&&(t=o.byId(t.getAttribute("for"))||t);var n=e.changedTouches?e.changedTouches[0]:e,a=function(t){var o=document.createEvent("MouseEvents");return o._dojo_click=!0,o.initMouseEvent(t,!0,!0,e.view,e.detail,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),o},u=a("mousedown"),s=a("mouseup"),d=a("click");setTimeout((function(){c.emit(t,"mousedown",u),c.emit(t,"mouseup",s),c.emit(t,"click",d),p=(new Date).getTime()}),0)}}),!0);var b=function(e){s.doc.addEventListener(e,(function(t){var o=t.target;g&&!t._dojo_click&&(new Date).getTime()<=p+1e3&&("INPUT"!=o.tagName||!n.contains(o,"dijitOffScreen"))&&(t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),"click"==e&&("INPUT"!=o.tagName||"radio"==o.type&&(n.contains(o,"dijitCheckBoxInput")||n.contains(o,"mblRadioButton"))||"checkbox"==o.type&&(n.contains(o,"dijitCheckBoxInput")||n.contains(o,"mblCheckBox")))&&"TEXTAREA"!=o.tagName&&"AUDIO"!=o.tagName&&"VIDEO"!=o.tagName&&t.preventDefault())}),!0)};b("click"),b("mousedown"),b("mouseup")}}}u("touch")&&r(j?function(){s.doc.addEventListener(w.down,(function(e){k(e,w.move,w.up)}),!0)}:function(){function e(e){var t=a.delegate(e,{bubbles:!0});return u("ios")>=6&&(t.touches=e.touches,t.altKey=e.altKey,t.changedTouches=e.changedTouches,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.targetTouches=e.targetTouches),t}T=s.body(),s.doc.addEventListener("touchstart",(function(e){b=(new Date).getTime();var t=T;T=e.target,c.emit(t,"dojotouchout",{relatedTarget:T,bubbles:!0}),c.emit(T,"dojotouchover",{relatedTarget:t,bubbles:!0}),k(e,"touchmove","touchend")}),!0),c(s.doc,"touchmove",(function(t){b=(new Date).getTime();var o=s.doc.elementFromPoint(t.pageX-(y?0:s.global.pageXOffset),t.pageY-(y?0:s.global.pageYOffset));o&&(T!==o&&(c.emit(T,"dojotouchout",{relatedTarget:o,bubbles:!0}),c.emit(o,"dojotouchover",{relatedTarget:T,bubbles:!0}),T=o),c.emit(o,"dojotouchmove",e(t))||t.preventDefault())})),c(s.doc,"touchend",(function(t){b=(new Date).getTime();var o=s.doc.elementFromPoint(t.pageX-(y?0:s.global.pageXOffset),t.pageY-(y?0:s.global.pageYOffset))||s.body();c.emit(o,"dojotouchend",e(t))}))});var O={press:Y("mousedown","touchstart",w.down),move:Y("mousemove","dojotouchmove",w.move),release:Y("mouseup","dojotouchend",w.up),cancel:Y(i.leave,"touchcancel",j?w.cancel:null),over:Y("mouseover","dojotouchover",w.over),out:Y("mouseout","dojotouchout",w.out),enter:i._eventHandler(Y("mouseover","dojotouchover",w.over)),leave:i._eventHandler(Y("mouseout","dojotouchout",w.out))};return u("extend-dojo")&&(e.touch=O),O}));