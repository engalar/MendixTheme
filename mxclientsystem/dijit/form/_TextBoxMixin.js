define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/sniff","dojo/keys","dojo/_base/lang","dojo/on","../main"],(function(e,t,i,s,n,a,o,r){var u=t("dijit.form._TextBoxMixin"+(s("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(e,t,i){var s;void 0!==e&&(s=this.filter(e),"string"!=typeof i&&(i=null===s||"number"==typeof s&&isNaN(s)?"":this.filter(this.format(s,this.constraints)),0!=this.compare(s,this.filter(this.parse(i,this.constraints)))&&(i=null))),null==i||"number"==typeof i&&isNaN(i)||this.textbox.value==i||(this.textbox.value=i,this._set("displayedValue",this.get("displayedValue"))),this.inherited(arguments,[s,t])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(e){null==e?e="":"string"!=typeof e&&(e=String(e)),this.textbox.value=e,this._setValueAttr(this.get("value"),void 0),this._set("displayedValue",this.get("displayedValue"))},format:function(e){return null==e?"":e.toString?e.toString():e},parse:function(e){return e},_refreshState:function(){},onInput:function(){},_onInput:function(e){this._lastInputEventValue=this.textbox.value,this._processInput(this._lastInputProducingEvent||e),delete this._lastInputProducingEvent,this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState(),this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value),this.inherited(arguments),this.own(o(this.textbox,"keydown, keypress, paste, cut, compositionend",a.hitch(this,(function(e){var t;if("keydown"==e.type&&229!=e.keyCode){switch(t=e.keyCode){case n.SHIFT:case n.ALT:case n.CTRL:case n.META:case n.CAPS_LOCK:case n.NUM_LOCK:case n.SCROLL_LOCK:return}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){switch(t){case n.NUMPAD_0:case n.NUMPAD_1:case n.NUMPAD_2:case n.NUMPAD_3:case n.NUMPAD_4:case n.NUMPAD_5:case n.NUMPAD_6:case n.NUMPAD_7:case n.NUMPAD_8:case n.NUMPAD_9:case n.NUMPAD_MULTIPLY:case n.NUMPAD_PLUS:case n.NUMPAD_ENTER:case n.NUMPAD_MINUS:case n.NUMPAD_PERIOD:case n.NUMPAD_DIVIDE:return}if(t>=65&&t<=90||t>=48&&t<=57||t==n.SPACE)return;var i=!1;for(var r in n)if(n[r]===e.keyCode){i=!0;break}if(!i)return}}if((t=e.charCode>=32?String.fromCharCode(e.charCode):e.charCode)||(t=e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode==n.SPACE?String.fromCharCode(e.keyCode):e.keyCode),t||(t=229),"keypress"==e.type){if("string"!=typeof t)return;if((t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||" "===t)&&(e.ctrlKey||e.metaKey||e.altKey))return}var u,l={faux:!0};for(u in e)if(!/^(layer[XY]|returnValue|keyLocation)$/.test(u)){var c=e[u];"function"!=typeof c&&void 0!==c&&(l[u]=c)}if(a.mixin(l,{charOrCode:t,_wasConsumed:!1,preventDefault:function(){l._wasConsumed=!0,e.preventDefault()},stopPropagation:function(){e.stopPropagation()}}),this._lastInputProducingEvent=l,!1===this.onInput(l)&&(l.preventDefault(),l.stopPropagation()),!l._wasConsumed&&s("ie")<=9)switch(e.keyCode){case n.TAB:case n.ESCAPE:case n.DOWN_ARROW:case n.UP_ARROW:case n.LEFT_ARROW:case n.RIGHT_ARROW:break;default:if(e.keyCode==n.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase())break;this.defer((function(){this.textbox.value!==this._lastInputEventValue&&o.emit(this.textbox,"input",{bubbles:!0})}))}}))),o(this.textbox,"input",a.hitch(this,"_onInput")),o(this.domNode,"keypress",(function(e){e.stopPropagation()})))},_blankValue:"",filter:function(e){return null===e?this._blankValue:("string"!=typeof e||(this.trim&&(e=a.trim(e)),this.uppercase&&(e=e.toUpperCase()),this.lowercase&&(e=e.toLowerCase()),this.propercase&&(e=e.replace(/[^\s]+/g,(function(e){return e.substring(0,1).toUpperCase()+e.substring(1)})))),e)},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(e){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(e){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==e&&(this._selectOnClickHandle=o.once(this.domNode,"mouseup, touchend",a.hitch(this,(function(e){this._isTextSelected()||u.selectInputText(this.textbox)}))),this.own(this._selectOnClickHandle),this.defer((function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)}),500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="",this.inherited(arguments)}});return s("dojo-bidi")&&(u=t("dijit.form._TextBoxMixin",u,{_setValueAttr:function(){this.inherited(arguments),this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments),this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode),this.inherited(arguments)}})),u._setSelectionRange=r._setSelectionRange=function(e,t,i){e.setSelectionRange&&e.setSelectionRange(t,i)},u.selectInputText=r.selectInputText=function(e,t,s){e=i.byId(e),isNaN(t)&&(t=0),isNaN(s)&&(s=e.value?e.value.length:0);try{e.focus(),u._setSelectionRange(e,t,s)}catch(e){}},u}));