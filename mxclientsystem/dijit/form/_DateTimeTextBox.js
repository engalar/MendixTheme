define(["dojo/date","dojo/date/locale","dojo/date/stamp","dojo/_base/declare","dojo/_base/lang","./RangeBoundTextBox","../_HasDropDown","dojo/text!./templates/DropDownBox.html"],(function(t,e,s,i,n,a,o,r){new Date("X");var l=i("dijit.form._DateTimeTextBox",[a,o],{templateString:r,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:e.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments),this._set("type","text")},compare:function(e,s){var i=this._isInvalidDate(e),n=this._isInvalidDate(s);if(i||n)return i&&n?0:i?-1:1;var a=this.format(e,this._unboundedConstraints),o=this.format(s,this._unboundedConstraints),r=this.parse(a,this._unboundedConstraints),l=this.parse(o,this._unboundedConstraints);return a==o?0:t.compare(r,l,this._selector)},autoWidth:!0,format:function(t,e){return t?this.dateLocaleModule.format(t,e):""},parse:function(t,e){return this.dateLocaleModule.parse(t,e)||(this._isEmpty(t)?null:void 0)},serialize:function(t,e){return t.toGregorian&&(t=t.toGregorian()),s.toISOString(t,e)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(s){s=s||{},this.dateModule=s.datePackage?n.getObject(s.datePackage,!1):t,this.dateClassObj=this.dateModule.Date||Date,this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value)),this.dateLocaleModule=s.datePackage?n.getObject(s.datePackage+".locale",!1):e,this._set("pattern",this.dateLocaleModule.regexp),this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments),this.hasDownArrow||(this._buttonNode.style.display="none"),this.hasDownArrow||(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(t){t.selector=this._selector,t.fullYear=!0;var e=s.fromISOString;"string"==typeof t.min&&(t.min=e(t.min),this.dateClassObj instanceof Date||(t.min=new this.dateClassObj(t.min))),"string"==typeof t.max&&(t.max=e(t.max),this.dateClassObj instanceof Date||(t.max=new this.dateClassObj(t.max))),this.inherited(arguments),this._unboundedConstraints=n.mixin({},this.constraints,{min:null,max:null})},_isDefinitelyOutOfRange:function(){var t,e,s,i,n=this.inherited(arguments),a=!1;return n&&(this.constraints.min||this.constraints.max)&&null!=(t=new RegExp(this._lastRegExp).exec(this._lastInputEventValue))&&(e=t[3],this.constraints.min&&(i=this.constraints.min instanceof Date?this.constraints.min:new Date(String(this.constraints.min)),minYear=i.getFullYear(),a=parseInt((e+"9999").substr(0,4),10)<minYear),!a&&this.constraints.max&&(s=this.constraints.max instanceof Date?this.constraints.max:new Date(String(this.constraints.max)),maxYear=s.getFullYear(),a=parseInt((e+"0000").substr(0,4),10)>maxYear),n=a),n},_isInvalidDate:function(t){return!t||isNaN(t)||"object"!=typeof t||t.toString()==this._invalidDate},_setValueAttr:function(t,e,i){void 0!==t&&("string"==typeof t&&(t=s.fromISOString(t)),this._isInvalidDate(t)&&(t=null),t instanceof Date&&!(this.dateClassObj instanceof Date)&&(t=new this.dateClassObj(t))),this.inherited(arguments,[t,e,i]),this.value instanceof Date&&(this.filterString=""),!1!==e&&this.dropDown&&this.dropDown.set("value",t,!1)},_set:function(t,e){if("value"==t){e instanceof Date&&!(this.dateClassObj instanceof Date)&&(e=new this.dateClassObj(e));var s=this._get("value");if(s instanceof this.dateClassObj&&0==this.compare(e,s))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(t){this._isInvalidDate(t)&&(t=new this.dateClassObj),this._set("dropDownDefaultValue",t)},openDropDown:function(t){this.dropDown&&this.dropDown.destroy();var e=n.isString(this.popupClass)?n.getObject(this.popupClass,!1):this.popupClass,s=this,i=this.get("value");this.dropDown=new e({onChange:function(t){s.set("value",t,!0)},id:this.id+"_popup",dir:s.dir,lang:s.lang,value:i,textDir:s.textDir,currentFocus:this._isInvalidDate(i)?this.dropDownDefaultValue:i,constraints:s.constraints,filterString:s.filterString,datePackage:s.datePackage,isDisabledDate:function(t){return!s.rangeCheck(t,s.constraints)}}),this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(t,e){this._setValueAttr(this.parse(t,this.constraints),e,t)}});return l}));